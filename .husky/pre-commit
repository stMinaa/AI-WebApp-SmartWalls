#!/usr/bin/env sh

echo "Running pre-commit checks..."
echo ""

# Step 1: lint-staged (prettier + eslint on staged files)
echo "Step 1/3: Running lint-staged (prettier + eslint)..."
npx lint-staged || exit 1
echo "lint-staged passed."
echo ""

# Step 2: Backend tests
echo "Step 2/3: Running backend tests..."
npx jest backend/test/ --bail --forceExit --runInBand || exit 1
echo "Backend tests passed."
echo ""

# Step 3: CodeScene delta (optional - only if cs is available)
if command -v cs >/dev/null 2>&1; then
  echo "Step 3/3: Running CodeScene delta analysis..."
  cs delta --staged || exit 1
  echo "CodeScene check passed."
else
  echo "Step 3/3: CodeScene not found, skipping."
fi

echo ""
echo "All pre-commit checks passed!"
